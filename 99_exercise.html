<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <title>DOM ë¹„ë™ê¸° ì²˜ë¦¬ í†µí•© ì‹¤ìŠµ</title>
    <style>
      body {
        font-family: sans-serif;
        padding: 20px;
        line-height: 1.6;
      }
      .container {
        max-width: 800px;
        margin: auto;
      }
      .control-group {
        margin-bottom: 25px;
        padding: 15px;
        border: 1px solid lightgray;
        border-radius: 5px;
      }
      h1,
      h2,
      h3 {
        border-bottom: 1px solid lightgray;
        padding-bottom: 10px;
      }
      button {
        margin: 5px;
        padding: 8px 12px;
        cursor: pointer;
        border-radius: 4px;
        border: 1px solid gray;
      }
      #log {
        border: 1px solid black;
        background-color: ghostwhite;
        min-height: 200px;
        padding: 10px;
        overflow-y: auto;
      }
      #log p {
        margin: 0 0 5px 0;
        padding-bottom: 5px;
        border-bottom: 1px solid lightgray;
        font-size: 14px;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>ë¹„ë™ê¸° ì²˜ë¦¬ í†µí•© ì‹¤ìŠµ</h1>

      <div class="control-group">
        <h2>ê¸°ë³¸ ë¹„ë™ê¸° íŒ¨í„´ (ìˆœì°¨ ì²˜ë¦¬)</h2>
        <button id="callback-btn">1. ì½œë°± ì§€ì˜¥ ì²´í—˜</button>
        <button id="promise-btn">2. Promiseë¡œ ê°œì„ </button>
        <button id="async-await-btn">3. Async/Await ìµœì¢…í˜•íƒœ</button>
      </div>

      <div class="control-group">
        <h2>Promise ë³‘ë ¬ ì²˜ë¦¬</h2>
        <button id="all-btn">Promise.all (ëª¨ë‘ ì„±ê³µí•´ì•¼)</button>
        <button id="race-btn">Promise.race (ê°€ì¥ ë¹ ë¥¸ ê²ƒ)</button>
      </div>

      <div class="control-group">
        <h2>ê²½ìŸ ìƒíƒœ (Race Condition)</h2>
        <p>ì•„ë˜ ë²„íŠ¼ë“¤ì„ ë¹ ë¥´ê²Œ ì—¬ëŸ¬ ë²ˆ í´ë¦­í•˜ì—¬ ë¡œê·¸ë¥¼ ë¹„êµí•´ë³´ì„¸ìš”.</p>
        <button id="race-problem-btn">ë¬¸ì œ ìƒí™© ì¬í˜„</button>
        <button id="race-solve-btn">í•´ê²° ì½”ë“œ ì ìš©</button>
      </div>

      <h3>ì‹¤í–‰ ê²°ê³¼ ë¡œê·¸</h3>
      <div id="log"></div>
      <button id="clear-log-btn" style="margin-top: 10px">ë¡œê·¸ ì§€ìš°ê¸°</button>
    </div>

    <script>
      // --- 1. ê¸°ë³¸ ìš”ì†Œ ë° í—¬í¼(Helper) í•¨ìˆ˜ ì¤€ë¹„ ---
      const logDiv = document.getElementById("log");

      // ë¡œê·¸ë¥¼ í™”ë©´ì— ì˜ˆì˜ê²Œ ì¶œë ¥í•˜ëŠ” í•¨ìˆ˜
      const log = (message) => {
        const now = new Date();
        const timestamp = `${now.getHours()}:${now.getMinutes()}:${String(
          now.getSeconds()
        ).padStart(2, "0")}.${String(now.getMilliseconds()).padStart(3, "0")}`;
        logDiv.innerHTML += `<p><strong>${timestamp}</strong> - ${message}</p>`;
        logDiv.scrollTop = logDiv.scrollHeight; // í•­ìƒ ë§ˆì§€ë§‰ ë¡œê·¸ê°€ ë³´ì´ë„ë¡ ìŠ¤í¬ë¡¤
      };

      // Promiseë¥¼ ë°˜í™˜í•˜ëŠ” ë¹„ë™ê¸° ì‘ì—… ì‹œë®¬ë ˆì´ì…˜ í•¨ìˆ˜
      const asyncTask = (taskName, ms) => {
        return new Promise((resolve) => {
          log(`â³ ${taskName} ì‹œì‘... (${ms / 1000}ì´ˆ)`);
          setTimeout(() => {
            log(`âœ… ${taskName} ì™„ë£Œ`);
            resolve(taskName); // ì‘ì—… ì´ë¦„ì„ ê²°ê³¼ë¡œ ë°˜í™˜
          }, ms);
        });
      };

      // --- 2. ê° ë²„íŠ¼ì— ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ(EventListener) í• ë‹¹ ---

      // [ì½œë°± ì§€ì˜¥] ë²„íŠ¼
      document.getElementById("callback-btn").addEventListener("click", () => {
        log("ì½œë°± ì§€ì˜¥ ì‹œì‘...");
        setTimeout(() => {
          log("1. ì‚¬ìš©ì ì¡°íšŒ");
          setTimeout(() => {
            log("2. ê²Œì‹œë¬¼ ì¡°íšŒ");
            setTimeout(() => {
              log("3. ëŒ“ê¸€ ì¡°íšŒ");
              log("...ì½œë°± ì§€ì˜¥ ì¢…ë£Œ");
            }, 1000);
          }, 1000);
        }, 1000);
      });

      // [Promise] ë²„íŠ¼
      document.getElementById("promise-btn").addEventListener("click", () => {
        log("Promise ì²´ì¸ ì‹œì‘...");
        asyncTask("1. ì‚¬ìš©ì ì¡°íšŒ", 1000)
          .then(() => asyncTask("2. ê²Œì‹œë¬¼ ì¡°íšŒ", 1000))
          .then(() => asyncTask("3. ëŒ“ê¸€ ì¡°íšŒ", 1000))
          .then(() => log("...Promise ì²´ì¸ ì¢…ë£Œ"));
      });

      // [Async/Await] ë²„íŠ¼
      document
        .getElementById("async-await-btn")
        .addEventListener("click", async () => {
          log("Async/Await ì‹œì‘...");
          await asyncTask("1. ì‚¬ìš©ì ì¡°íšŒ", 1000);
          await asyncTask("2. ê²Œì‹œë¬¼ ì¡°íšŒ", 1000);
          await asyncTask("3. ëŒ“ê¸€ ì¡°íšŒ", 1000);
          log("...Async/Await ì¢…ë£Œ");
        });

      // [Promise.all] ë²„íŠ¼
      document.getElementById("all-btn").addEventListener("click", async () => {
        log("Promise.all ì‹œì‘ (3ê°œ ì‘ì—… ë™ì‹œ ì‹¤í–‰)");
        const tasks = [
          asyncTask("ì„¤ì • ì •ë³´ ë¡œë“œ", 1500),
          asyncTask("ì‚¬ìš©ì ë°ì´í„° ë¡œë“œ", 2000), // ê°€ì¥ ì˜¤ë˜ ê±¸ë¦¼
          asyncTask("ì œí’ˆ ëª©ë¡ ë¡œë“œ", 1000),
        ];
        // 3ê°œì˜ Promiseê°€ ëª¨ë‘ resolveë  ë•Œê¹Œì§€ ê¸°ë‹¤ë¦½ë‹ˆë‹¤.
        const results = await Promise.all(tasks);
        log(
          `ğŸ‰ <strong>Promise.all ì™„ë£Œ!</strong> ëª¨ë“  ê²°ê³¼: [${results.join(
            ", "
          )}] (ì´ ${2000 / 1000}ì´ˆ ì†Œìš”)`
        );
      });

      // [Promise.race] ë²„íŠ¼
      document
        .getElementById("race-btn")
        .addEventListener("click", async () => {
          log("Promise.race ì‹œì‘ (ê°€ì¥ ë¹ ë¥¸ ì„œë²„ ì°¾ê¸°)");
          const servers = [
            asyncTask("ì„œë²„ A", 1200),
            asyncTask("ì„œë²„ B", 800), // ê°€ì¥ ë¹ ë¦„
            asyncTask("ì„œë²„ C", 2000),
          ];
          // 3ê°œì˜ Promise ì¤‘ ê°€ì¥ ë¨¼ì € resolveë˜ëŠ” ê²ƒì˜ ê²°ê³¼ë¥¼ ë°›ìŠµë‹ˆë‹¤.
          const winner = await Promise.race(servers);
          log(
            `ğŸ† <strong>Promise.race ì™„ë£Œ!</strong> ê°€ì¥ ë¹ ë¥¸ ì„œë²„: ${winner}`
          );
        });

      // --- ê²½ìŸ ìƒíƒœ(Race Condition) ì‹¤ìŠµ ---
      let latestRequestNum = 0; // ìµœì‹  ìš”ì²­ ë²ˆí˜¸ë¥¼ ì¶”ì í•˜ëŠ” ë³€ìˆ˜

      // [ë¬¸ì œ ìƒí™©] ë²„íŠ¼
      document
        .getElementById("race-problem-btn")
        .addEventListener("click", () => {
          const currentRequestNum = ++latestRequestNum;
          log(`(ë¬¸ì œ) <strong>ìš”ì²­ ${currentRequestNum}</strong> ì‹œì‘`);

          // 1.5ì´ˆê°€ ê±¸ë¦¬ëŠ” ë¹„ë™ê¸° ì‘ì—…ì´ë¼ê³  ê°€ì •
          setTimeout(() => {
            // ì´ ì‘ë‹µì´ ìµœì‹  ìš”ì²­ì— ëŒ€í•œ ê²ƒì¸ì§€ í™•ì¸í•˜ëŠ” ë¡œì§ì´ ì—†ìŒ
            log(
              `<span style="color:red;">(ë¬¸ì œ) <strong>ì‘ë‹µ ${currentRequestNum}</strong> ë„ì°©! ì´ ë°ì´í„°ë¡œ í™”ë©´ì„ ì—…ë°ì´íŠ¸í•©ë‹ˆë‹¤.</span>`
            );
          }, 1500);
        });

      // [í•´ê²° ì½”ë“œ] ë²„íŠ¼
      document
        .getElementById("race-solve-btn")
        .addEventListener("click", () => {
          const currentRequestNum = ++latestRequestNum;
          log(`(í•´ê²°) <strong>ìš”ì²­ ${currentRequestNum}</strong> ì‹œì‘`);

          setTimeout(() => {
            // ì‘ë‹µì´ ë„ì°©í•œ ì‹œì , í˜„ì¬ ìš”ì²­ ë²ˆí˜¸ê°€ ì „ì²´ ìµœì‹  ìš”ì²­ ë²ˆí˜¸ì™€ ê°™ì€ì§€ í™•ì¸
            if (currentRequestNum === latestRequestNum) {
              log(
                `<span style="color:green;">(í•´ê²°) <strong>ì‘ë‹µ ${currentRequestNum}</strong> ë„ì°©! ìµœì‹  ìš”ì²­ì´ë¯€ë¡œ í™”ë©´ ì—…ë°ì´íŠ¸!</span>`
              );
            } else {
              log(
                `<span style="color:gray;">(í•´ê²°) <strong>ì‘ë‹µ ${currentRequestNum}</strong> ë„ì°©! (í•˜ì§€ë§Œ ìµœì‹  ìš”ì²­(${latestRequestNum})ì´ ì•„ë‹ˆë¯€ë¡œ ë¬´ì‹œ)</span>`
              );
            }
          }, 1500);
        });

      // [ë¡œê·¸ ì§€ìš°ê¸°] ë²„íŠ¼
      document.getElementById("clear-log-btn").addEventListener("click", () => {
        logDiv.innerHTML = "";
      });
    </script>
  </body>
</html>
