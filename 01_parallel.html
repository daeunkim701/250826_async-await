<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>4. Promise ë³‘ë ¬ ì²˜ë¦¬</title>
    <style>
        body { font-family: sans-serif; padding: 20px; }
        .container { max-width: 600px; margin: auto; padding: 20px; border: 1px solid lightgray; border-radius: 8px; }
        button { padding: 10px 15px; font-size: 16px; cursor: pointer; margin: 5px; }
        #log { margin-top: 20px; padding: 10px; border: 1px solid black; background-color: ghostwhite; min-height: 150px; }
    </style>
</head>
<body>
    <div class="container">
        <h1>4. Promise ë³‘ë ¬ ì²˜ë¦¬ (All, Race)</h1>
        <p>ì—¬ëŸ¬ ê°œì˜ ë¹„ë™ê¸° ì‘ì—…ì„ ë™ì‹œì— ì²˜ë¦¬í•˜ëŠ” ë°©ë²•ì„ ì‹¤ìŠµí•©ë‹ˆë‹¤.</p>
        <button id="all-btn">Promise.all (ëª¨ë‘ ì™„ë£Œë  ë•Œê¹Œì§€)</button>
        <button id="race-btn">Promise.race (ê°€ì¥ ë¹ ë¥¸ í•˜ë‚˜ë§Œ)</button>
        <div id="log"></div>
    </div>

    <script>
        const allBtn = document.getElementById('all-btn');
        const raceBtn = document.getElementById('race-btn');
        const logDiv = document.getElementById('log');

        const log = (message) => {
            logDiv.innerHTML += `<div>${new Date().toLocaleTimeString()} - ${message}</div>`;
            logDiv.scrollTop = logDiv.scrollHeight;
        };

        // ì´ë¦„ê³¼ ì§€ì—° ì‹œê°„ì„ ë°›ì•„ Promiseë¥¼ ë°˜í™˜í•˜ëŠ” í•¨ìˆ˜
        const delayedTask = (name, delay) => new Promise(resolve => {
            log(`'${name}' ì‘ì—… ì‹œì‘ (ì†Œìš”ì‹œê°„: ${delay / 1000}ì´ˆ)`);
            setTimeout(() => {
                log(`âœ… '${name}' ì‘ì—… ì™„ë£Œ`);
                resolve(name);
            }, delay);
        });

        /*
        ==================================================================================
        ğŸ¯ Promise.all: ëª¨ë“  ì‘ì—…ì´ ëë‚  ë•Œê¹Œì§€ ê¸°ë‹¤ë¦¬ê¸°
        ==================================================================================
        - ì—¬ëŸ¬ ê°œì˜ Promiseë¥¼ ë°°ì—´ë¡œ ë°›ì•„, ëª¨ë“  Promiseê°€ ì„±ê³µ(fulfilled)í•˜ë©´ ê²°ê³¼ë¥¼ ë°°ì—´ë¡œ ë°˜í™˜í•©ë‹ˆë‹¤.
        - í•˜ë‚˜ë¼ë„ ì‹¤íŒ¨(rejected)í•˜ë©´ ì¦‰ì‹œ ì „ì²´ê°€ ì‹¤íŒ¨í•©ë‹ˆë‹¤.
        - ì‚¬ìš© ì˜ˆ: í˜ì´ì§€ ë Œë”ë§ì— í•„ìš”í•œ ì—¬ëŸ¬ ë°ì´í„°ë¥¼ ëª¨ë‘ ë°›ì•„ì˜¨ í›„ í™”ë©´ì„ ê·¸ë¦´ ë•Œ
        */
        allBtn.addEventListener('click', () => {
            logDiv.innerHTML = '';
            log('Promise.all í…ŒìŠ¤íŠ¸ ì‹œì‘...');

            const tasks = [
                delayedTask('API 1: ì‚¬ìš©ì ì •ë³´', 1500),
                delayedTask('API 2: ìƒí’ˆ ëª©ë¡', 2000), // ì´ ì‘ì—…ì´ ê°€ì¥ ì˜¤ë˜ ê±¸ë¦¼
                delayedTask('API 3: ê´‘ê³  ë°°ë„ˆ', 1000)
            ];

            Promise.all(tasks)
                .then(results => {
                    // ëª¨ë“  ì‘ì—…ì´ ì™„ë£Œë˜ë©´(ê°€ì¥ ê¸´ 2ì´ˆ í›„), ê²°ê³¼ê°€ ë°°ì—´ë¡œ í•œ ë²ˆì— ë“¤ì–´ì˜µë‹ˆë‹¤.
                    log(`ğŸ‰ Promise.all ì„±ê³µ! ëª¨ë“  ê²°ê³¼: [${results.join(', ')}]`);
                })
                .catch(error => {
                    log(`â—ï¸ Promise.all ì‹¤íŒ¨: ${error.message}`);
                });
        });

        /*
        ==================================================================================
        ğŸ¯ Promise.race: ê°€ì¥ ë¹ ë¥¸ ì‘ì—…ë§Œ ê¸°ë‹¤ë¦¬ê¸°
        ==================================================================================
        - ì—¬ëŸ¬ ê°œì˜ Promiseë¥¼ ë°°ì—´ë¡œ ë°›ì•„, ê·¸ì¤‘ ê°€ì¥ ë¨¼ì € ì™„ë£Œ(ì„±ê³µ ë˜ëŠ” ì‹¤íŒ¨)ë˜ëŠ” Promiseì˜ ê²°ê³¼ë¥¼ ë”°ë¦…ë‹ˆë‹¤.
        - ì‚¬ìš© ì˜ˆ: ì—¬ëŸ¬ ì„œë²„ ì¤‘ ê°€ì¥ ì‘ë‹µì´ ë¹ ë¥¸ ì„œë²„ì˜ ë°ì´í„°ë¥¼ ì‚¬ìš©í•˜ê±°ë‚˜, íŠ¹ì • ì‹œê°„ ë‚´ì— ì‘ë‹µì´ ì—†ìœ¼ë©´ íƒ€ì„ì•„ì›ƒ ì²˜ë¦¬í•  ë•Œ
        */
        raceBtn.addEventListener('click', () => {
            logDiv.innerHTML = '';
            log('Promise.race í…ŒìŠ¤íŠ¸ ì‹œì‘...');

            const servers = [
                delayedTask('ê°€ì¥ ëŠë¦° ì„œë²„', 2000),
                delayedTask('ë³´í†µ ì„œë²„', 1500),
                delayedTask('ê°€ì¥ ë¹ ë¥¸ ì„œë²„', 800) // ì´ ì‘ì—…ì´ ê°€ì¥ ë¹ ë¦„
            ];

            Promise.race(servers)
                .then(winner => {
                    // ê°€ì¥ ë¹ ë¥¸ ì‘ì—…(800ms)ì´ ì™„ë£Œë˜ëŠ” ì¦‰ì‹œ .thenì´ ì‹¤í–‰ë©ë‹ˆë‹¤.
                    log(`ğŸ† Promise.race ìŠ¹ì: '${winner}' (ê°€ì¥ ë¨¼ì € ì‘ë‹µ)`);
                })
                .catch(error => {
                    log(`â—ï¸ Promise.race ì‹¤íŒ¨: ${error.message}`);
                });
        });

    </script>
</body>
</html>