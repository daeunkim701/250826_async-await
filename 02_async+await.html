<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>5. Async Await</title>
    <style>
        body { font-family: sans-serif; padding: 20px; }
        .container { max-width: 600px; margin: auto; padding: 20px; border: 1px solid lightgray; border-radius: 8px; }
        button { padding: 10px 15px; font-size: 16px; cursor: pointer; margin: 5px; }
        #log { margin-top: 20px; padding: 10px; border: 1px solid black; background-color: ghostwhite; min-height: 150px; }
    </style>
</head>
<body>
    <div class="container">
        <h1>5. Async/Awaitë¡œ ë¹„ë™ê¸° ì½”ë“œ ë™ê¸°ì²˜ëŸ¼ ì‘ì„±í•˜ê¸°</h1>
        <p>Promise ê¸°ë°˜ ì½”ë“œë¥¼ ê°€ì¥ ê¹”ë”í•˜ê³  ì§ê´€ì ìœ¼ë¡œ ë§Œë“œëŠ” ë°©ë²•ì„ í™•ì¸í•˜ì„¸ìš”.</p>
        <button id="start-btn">ì‘ì—… ì‹œì‘ (ì„±ê³µ)</button>
        <button id="fail-btn">ì‘ì—… ì‹œì‘ (ì‹¤íŒ¨)</button>
        <div id="log"></div>
    </div>
    
    <script>
        const startBtn = document.getElementById('start-btn');
        const failBtn = document.getElementById('fail-btn');
        const logDiv = document.getElementById('log');

        const log = (message, isError = false) => {
            logDiv.innerHTML += `<div style="color: ${isError ? 'red' : 'black'};">${message}</div>`;
        };

        /*
        ==================================================================================
        ğŸ¯ Async / Await ì´ë€?
        ==================================================================================
        - Promiseë¥¼ ë” ì‰½ê²Œ ì‚¬ìš©í•˜ê¸° ìœ„í•œ 'ë¬¸ë²•ì  ì„¤íƒ•(Syntactic Sugar)'ì…ë‹ˆë‹¤.
        - async: í•¨ìˆ˜ ì•ì— ë¶™ì´ë©´ í•´ë‹¹ í•¨ìˆ˜ëŠ” í•­ìƒ Promiseë¥¼ ë°˜í™˜í•©ë‹ˆë‹¤.
        - await: async í•¨ìˆ˜ ì•ˆì—ì„œë§Œ ì‚¬ìš© ê°€ëŠ¥í•˜ë©°, Promiseê°€ ì™„ë£Œë  ë•Œê¹Œì§€ ì½”ë“œ ì‹¤í–‰ì„ 'ê¸°ë‹¤ë¦½ë‹ˆë‹¤'.
                ì™„ë£Œë˜ë©´ Promiseì˜ ê²°ê³¼ê°’ì„ ë°˜í™˜í•©ë‹ˆë‹¤.
        - ì¥ì : ë¹„ë™ê¸° ì½”ë“œë¥¼ ë™ê¸° ì½”ë“œì²˜ëŸ¼ ìˆœì°¨ì ìœ¼ë¡œ ì‘ì„±í•  ìˆ˜ ìˆì–´ ê°€ë…ì„±ì´ ë§¤ìš° í–¥ìƒë©ë‹ˆë‹¤.
        - ì—ëŸ¬ ì²˜ë¦¬: Promiseì˜ .catch() ëŒ€ì‹ , ë™ê¸° ì½”ë“œì—ì„œì™€ ë™ì¼í•œ try...catch êµ¬ë¬¸ì„ ì‚¬ìš©í•©ë‹ˆë‹¤.
        */

        // Promiseë¥¼ ë°˜í™˜í•˜ëŠ” ê¸°ë³¸ ë¹„ë™ê¸° í•¨ìˆ˜ (ì´ì „ ì˜ˆì œì™€ ë™ì¼)
        function asyncTask(taskName, duration, shouldSucceed) {
            return new Promise((resolve, reject) => {
                setTimeout(() => {
                    if (shouldSucceed) {
                        log(`âœ… '${taskName}' ì™„ë£Œ`);
                        resolve(taskName);
                    } else {
                        log(`âŒ '${taskName}' ì‹¤íŒ¨`);
                        reject(new Error(`'${taskName}'ì—ì„œ ë¬¸ì œ ë°œìƒ`));
                    }
                }, duration);
            });
        }

        // async/awaitë¥¼ ì‚¬ìš©í•œ ë¹„ë™ê¸° ì‘ì—… íë¦„ ì œì–´
        async function runProcess(shouldFail) {
            log('ğŸš€ ì‘ì—… í”„ë¡œì„¸ìŠ¤ë¥¼ ì‹œì‘í•©ë‹ˆë‹¤...');
            try {
                // await: asyncTaskê°€ resolveë  ë•Œê¹Œì§€ ì—¬ê¸°ì„œ ê¸°ë‹¤ë¦½ë‹ˆë‹¤.
                const result1 = await asyncTask('1. ì‚¬ìš©ì ì¸ì¦', 1000, true);
                log(`- ì¤‘ê°„ ê²°ê³¼ 1: ${result1}`);

                // ì¤‘ê°„ì— ì‹¤íŒ¨ë¥¼ ì£¼ì…í• ì§€ ê²°ì •
                const step2Success = !shouldFail;
                const result2 = await asyncTask('2. ë°ì´í„° ë¡œë“œ', 1000, step2Success);
                log(`- ì¤‘ê°„ ê²°ê³¼ 2: ${result2}`);

                const result3 = await asyncTask('3. ê²°ê³¼ í™”ë©´ ë Œë”ë§', 1000, true);
                log(`- ì¤‘ê°„ ê²°ê³¼ 3: ${result3}`);

                log('ğŸ‰ ëª¨ë“  ì‘ì—…ì´ ì„±ê³µì ìœ¼ë¡œ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.');

            } catch (error) {
                // await í•˜ë˜ Promise ì¤‘ í•˜ë‚˜ë¼ë„ rejectë˜ë©´, ì¦‰ì‹œ catch ë¸”ë¡ì´ ì‹¤í–‰ë©ë‹ˆë‹¤.
                log(`â—ï¸ ì—ëŸ¬ ë°œìƒ! í”„ë¡œì„¸ìŠ¤ ì¤‘ë‹¨: ${error.message}`, true);
            } finally {
                // ì„±ê³µí•˜ë“  ì‹¤íŒ¨í•˜ë“  ë§ˆì§€ë§‰ì— í•­ìƒ ì‹¤í–‰ë©ë‹ˆë‹¤.
                log('ğŸ ì‘ì—… í”„ë¡œì„¸ìŠ¤ë¥¼ ì¢…ë£Œí•©ë‹ˆë‹¤.');
            }
        }

        startBtn.addEventListener('click', () => {
            logDiv.innerHTML = '';
            runProcess(false); // ì‹¤íŒ¨ ì—†ì´ ì‹¤í–‰
        });
        
        failBtn.addEventListener('click', () => {
            logDiv.innerHTML = '';
            runProcess(true); // ì¤‘ê°„ì— ì‹¤íŒ¨í•˜ë„ë¡ ì‹¤í–‰
        });

    </script>
</body>
</html>